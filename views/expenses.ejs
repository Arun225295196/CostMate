<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/navbar') %>
    
    <main class="container">
        <h4>My Expenses</h4>
        
        <%- include('partials/messages') %>
        
        <div class="row">
            <div class="col s12">
                <a href="/expenses/add" class="btn blue waves-effect waves-light">
                    <i class="material-icons left">add</i>Add Expense
                </a>
            </div>
        </div>
        
        <div class="row">
            <div class="col s12">
                <% if (typeof expenses !== 'undefined' && expenses.length > 0) { %>
                    <table class="striped responsive-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Payment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% expenses.forEach(expense => { %>
                                <tr>
                                    <td><%= new Date(expense.date).toLocaleDateString() %></td>
                                    <td>
                                        <span class="expense-category category-<%= expense.category %>">
                                            <%= expense.category %>
                                        </span>
                                    </td>
                                    <td><%= expense.description %></td>
                                    <td><strong>$<%= expense.amount.toFixed(2) %></strong></td>
                                    <td><%= expense.paymentMethod %></td>
                                    <td>
                                        <a href="/expenses/edit/<%= expense._id %>" class="btn-small blue">
                                            <i class="material-icons">edit</i>
                                        </a>
                                        <form action="/expenses/<%= expense._id %>?_method=DELETE" method="POST" style="display: inline;">
                                            <button type="submit" class="btn-small red" onclick="return confirm('Delete this expense?')">
                                                <i class="material-icons">delete</i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                    
                    <% if (typeof currentPage !== 'undefined' && typeof totalPages !== 'undefined' && totalPages > 1) { %>
                        <ul class="pagination center-align" style="margin-top: 30px;">
                            <% for(let i = 1; i <= totalPages; i++) { %>
                                <li class="<%= currentPage === i ? 'active blue' : 'waves-effect' %>">
                                    <a href="/expenses?page=<%= i %>"><%= i %></a>
                                </li>
                            <% } %>
                        </ul>
                    <% } %>
                <% } else { %>
                    <div class="card-panel">
                        <p class="center-align">No expenses found. Start by adding your first expense!</p>
                    </div>
                <% } %>
            </div>
        </div>
    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
